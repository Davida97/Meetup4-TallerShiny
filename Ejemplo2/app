library(shiny)
library(gapminder)
library(ggplot2)

ui = fluidPage(
    titlePanel("Ejemplo"),
    sidebarLayout(
      position = c("left", "right"), fluid = TRUE,
      sidebarPanel(
        selectInput("var_country", "Selecciona un país:", 
                    choices = levels(gapminder$country)), 
        sliderInput("var_year", "Año:",
                    min = min(gapminder$year),
                    max = max(gapminder$year),
                    value = min(gapminder$year), 
                    step = 5,
                    animate = animationOptions(interval = 1000,loop = TRUE)),
        checkboxInput(inputId = "var_continent",
                      label = strong("Mostrar continentes en color."), 
                      value = FALSE)
      ),
      mainPanel(
        plotOutput("thisPlot")
      )
    )
  )

server = function(input, output) {
    output$thisPlot <- renderPlot({
      TmpX = gapminder[gapminder$year==input$var_year, ]
      idx1 = which(TmpX$country == input$var_country)
      RangePop = range(gapminder$pop)
      p = ggplot(TmpX, aes(gdpPercap, lifeExp, size = pop)) +
        geom_point(alpha=1/3) + ylim(20, 90) + 
        geom_text(aes(TmpX$gdpPercap[idx1], TmpX$lifeExp[idx1]), 
                  label=input$var_country, size=8, color=1) +
        scale_x_log10(limits = range(gapminder$gdpPercap)) + 
        scale_size(guide = "none", range = c(1,20)*range(TmpX$pop)/RangePop) + 
        theme_classic() + 
        labs(x="GDP per capita", y="Life Expectancy") 
      if (!input$var_continent) print(p)
      if (input$var_continent) p + geom_point(aes(color=continent)) +
        scale_color_manual(values = c(3,2,4,5,6))
    })
}

shinyApp(ui = ui, server = server)
